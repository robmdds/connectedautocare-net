
# Build-Out Sheet (Replit)

## Goal
Build a full-service TPA platform (auto/RV/marine/powersports/home) with:
- Rating via spreadsheets + external APIs
- VIN decode with manual entry
- D2C + reseller portals, white-label microsites and widgets
- Tax calc by purchaser location
- Checkout with **Helcim** payments only
- Contract doc gen + e-sign (DocuSign/Adobe Sign adapters)
- Claims (FNOL→decision→payout), adjuster workflows
- Analytics/KPIs + AI assistant (RAG over disclosures/FAQ)
- Multi-tenant, multi-language/currency

## Replit Run
- **Run command:** installs deps and starts both apps via `concurrently`.
- **Web:** http://localhost:3000
- **API:** http://localhost:4000 (health at `/health`)

## Env (.env)
- `NODE_ENV=development`
- `NEXT_PUBLIC_API_URL=http://localhost:4000`
- `PAYMENTS_PROVIDER=helcim`
- `HELCIM_API_BASE=https://api.helcim.com`
- `HELCIM_API_TOKEN=...`
- `HELCIM_ACCOUNT_ID=...`
- `HELCIM_WEBHOOK_SECRET=...`

## Minimal Steps for AI on Replit
1. **Database**: Generate Prisma schema + migrations for users, orgs, products, rate tables, vehicles, quotes/offers, policies, documents, claims, payments, webhooks, events.
2. **Rating Engine**: Spreadsheet import + validation, rules engine, external adapter interface.
3. **Payments (Helcim)**: Real API calls, webhook signature verify; on success → policy issuance + document generation.
4. **Portals**: Consumer, Reseller, Admin UIs per features.
5. **AI Assistant**: RAG over KB (disclosures/FAQ) with guardrails.
6. **Analytics**: Event tracking + dashboards.

## Acceptance Checks
- Upload rate table → valid + active by effective dates.
- VIN fallback + manual override persists.
- Helcim webhook triggers policy issuance; receipt stored.
- D2C flow: quote → checkout → e-sign (stub) → documents visible in portal.
- Reseller microsite + embeddable widget usable.
- Claims path from FNOL to decision; audit trail present.


## Complete Feature List
1) Product & Coverage Management: multi-industry catalog, versioned rate tables (CSV/XLSX), effective dates, API-based rating, surcharges, locale content.
2) Rating & Quote Engine: VIN decode (ChromeData/NHTSA) + manual entry, age/mileage bands, coverage/deductible selection, tax calc by location, promo codes, reseller markups, multi-currency.
3) Checkout & Payments: Helcim-only provider (intent, webhook verification, refunds), tokenized PCI flow, sales tax on totals, auto-issue policy + receipt on payment.succeeded.
4) Policy Management: lifecycle (issued→active→renewal→expired/cancelled), auto-renew, documents (contract/disclosures/receipts/ID cards), S3/MinIO storage, multi-tenant.
5) Claims Management: FNOL, uploads, workflow (open→review→awaiting docs→estimate→decision→payout→closed), adjuster assignment, immutable audit log, KPIs.
6) Reseller Tools: dashboard KPIs, commissions, white-label microsites, embeddable quote widget (/sdk.js), prefilled quote links, CRM hooks (HubSpot/Zoho/DealerSocket).
7) Consumer Portal: policy view, docs download, renewals & auto-renew, claims filing/tracking, payment history, secure messaging.
8) Admin Console: tenant/reseller mgmt, product CRUD, rate upload/validation, rules editor, disclosures CMS, webhook monitor, feature flags, analytics dashboards.
9) AI Assistant: RAG over KB (disclosures/FAQs), plan comparison, claim guidance, roadside routing, guardrails + PII redaction for transcripts.
10) Analytics & KPIs: events (page_view, quote_created, checkout_started, policy_issued, claim_opened, renewal_started, etc.), funnels, CAC/LTV, attribution (UTM), reseller leaderboards.
11) Security & Compliance: RBAC (admin/reseller_admin/reseller_agent/consumer/adjuster), PII encryption, WCAG 2.1 AA, SOC2-ready logging & audit, GDPR/CCPA requests, PCI minimized (Helcim).
12) Integrations & Extensibility: VIN adapters, tax provider swap, e-sign adapters (DocuSign/Adobe), rating API adapter interface, CRM/webhooks for resellers.

